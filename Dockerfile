# Stage 1: Build the application
FROM gradle:8.5.0-jdk21 AS build
WORKDIR /home/gradle/project
COPY --chown=gradle:gradle . .
RUN gradle build -x test

# Stage 2: Create the runtime image
FROM eclipse-temurin:21-jdk-jammy
WORKDIR /app
COPY --from=build /home/gradle/project/build/libs/*.jar app.jar
# Set the Firebase credentials as an environment variable (INSECURE)
ENV FIREBASE_SERVICE_ACCOUNT='{"type": "service_account","project_id": "isms-f64f7","private_key_id": "5769aa8a75e1891469e15c5207d027d562e2faf0","private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC86kmbN+5ljPHM\nNM1Eh80Ku+vmUBVNR3EprOqzcVBQJ2Xmn9WHXTPCF+ck+iXbw9+hPZJIvfFnIAGg\nnVK2LJrEqULYURs8V7gfsUhPBP7IEPuLsA0Az8ua0Yb48Zz0yzq7hXZiVRL06GlK\nsJ/BFStAXuKYrMRInLzogwbTpTv1s1S5J/nzVAd3SklAi3zvw//x444O+7lxFsQq\nVQfAvF/KqF8rPkBThKM6+qOsrCbGpAyC3XrN5ZFjR5sI0is3ktCxD5gHXNEmODqj\nEnf4SDRvL62lUAcz3pmA+BW/UtEDjaBYMln5nQ4rIQhDxGuoXn+K5XV7ZOTCAP3n\n7JBUKdgFAgMBAAECggEAUdkH7vH6nZDFKf4ueOSFV4M3n19O+15ajv3V6czMSQ3o\nvlS9hJpC1HLauFCQmnhwqUEt4co5jr51NgszTK5il5Xl2ia5sBkpMsHyXBoD8NY6\nxbiOya09v2PMIIs9v2lVlu0p70yAnA8dnziK3nK3fHofnporqHIP/oTWLlhGdBpx\nqIxe1ZlB8vuAZO7B5LFMXJzZAUw5cmEpjP+Zm4NFfHXjbshaljF1J+zhKV7BCwqZ\niEeHfTIh46zcjOznlniM57clBdLZnaUsUlxuAAinMmK+lUb6iKr5Fueu28rQXTb+\n+T0AiHiZ9QfViqaGBuPNGgOzptlZ9v3d+GPDNSlUeQKBgQDdNRpjvXZQLmb5MUXs\ni6ATXD83ac4kWXe4hb1nD4efceNX8HQJQgajG4rPu0+4lIyVv8+yfXuRpy8t61z6\nHAYgPr19Ji3Z0+XBxfgCwngCZv9WMtATVS72h7NGovP5f65bkp3uHR68U8WB83hs\nBAB96jqk3ZGuXgJr3/9odudICwKBgQDaoPCmp+ZEZpwOVEUNO0TlJ/qESGkUyg9r\n4M8I1bsd3O6AtH1ZuIpABAKGukYs3h61JQewk9bLTKtG0StdQWpcqueVXLQjJyDi\nbVWZd+UC4xRdgX0D3g81UoUmNcMwO3GGOcvMsqGIQ9uZxAsmRZe6D3LPgvdlMtKe\nKgb7LDeaLwKBgEyuIc29WYwF6dAsEm8jH4RWj9tno/vZv7SJN9TH/114HzTWt4KW\nDrLv0zibV9FGPU2Txi27beBZsfMbCYnxuPXoicseNvqxh42aUJS0UOGUTqLUzmhF\nORhghfbQef5dElXQB0sJcSQbbfXULkRTRtBfJ6EK5XsqP3Chn2nY/edtAoGBAIHM\nfTOkiRxhAxOqylhBsPSQGLaCuwhhsmgszx4CrpXbPiphfe5PlpzNBKbyXoly0i5f\nrsIR87s9aI6hzqoOFVSxDs7pe/VG3MoxeVmlCez93nBpWUx7gPH6bRyzXI/9Krgz\nBiEgiLB7ARy4fJobRSps05AJxFFrrAnFD+H9bYF3AoGBAJwpyTa0ZiuI/pqIjfpj\nXbd3Rp79sjyhXaElUQk5As8u+3WRr3OtvphTbBWidBUIQLLcLTBrbtqAXOB6AscO\nUry9laHci7gN+9zYO+rIykjhHgvsuqooYc3of2oJqL6GctXzlj8yshbS0W+Z2EWj\ntu1XmajOZwbL5cZFXqubp4KC\n-----END PRIVATE KEY-----\n","client_email": "firebase-adminsdk-fbsvc@isms-f64f7.iam.gserviceaccount.com","client_id": "104421130341628731170","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40isms-f64f7.iam.gserviceaccount.com","universe_domain": "googleapis.com"}'
ENV DRIVE_SERVICE_ACCOUNT='{"type": "service_account","project_id": "isms-file-store","private_key_id": "6a965ee8bd7c2ed83962fa5e48ccaa80bd322081","private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQChYQcfg4dqb4+0\nGEdzivLaIB+FiUpzyeHYAsstIyak/SZ0BwXx5LRD8BfgTIIozsmRARKK4LatrKII\nTqxktZXl0lge8XlsrkHDI2BWZGAqrcXFrVb78i9oaXP2OdA/lDxkm3kKGkVdxJrX\nkDeDMV5tLTYZzKWo9lfh5g4yHePjji5RnINT6yfiWdSmtO9ano98QyyVM0mrySQG\nzzC14HTTe1YKffU6Fbj+vTLNLV04/viHZIngWXJ17LLHWW1rnizvzG34qwoHKsV0\nJJUOMHLCyc3gKWYJ4wFuVFZeUjkpbLdcQcoiKhilz7Wz3fUwSWm2mEF0bF2p5EGz\ni6vEl8adAgMBAAECggEAB8b7tBkZCmTpMaGGtmeYrJc/unL5xseQvft+FZhlrfqr\nqViggLfbUcR2yIIanVZzgF/jQa4l7HJiNkqt8QYo4zQjHkELVdS2dqEN04JvrNIT\nGSO+PWyLVfM/E268PbqQu1VPnNA6gS2O1ZsUEc6Frnbih8iR2akfMyCf+1C72thV\nURgobqkMjrPYf7+r4bvqqiD/E8/giuQ1MPt+pbHCaKsaFtzbH/GraeWWc0/49O7g\nibXi7iXkc0+/JUUnE7yKa7bjLcOKC6P7xqvYuZhWOuygNPtZffPBHSmTKlAOgYlM\nA2IWerVonxJ9y5JYTLT4HXXRbvhVWr/2Gg0RFyTOQQKBgQDPiEXD7tGNezP7Lkor\nbUNvFz+HHRF89sQvvCmOUNXArc5Zq97Bbny6NJ/dd9IMHseyjVdkA5Rk5wNJCPCi\nNQgiZkCGXvHrdaj+zQlL3XaE9Tj9GVI4xNZlk+JjFRW9LdW/s381Sgk9fmcL2kpu\n7ZY6kMEsxtBdVl3dNXSeqR7RCwKBgQDHEWO44HDhXHseLASq6d7rgu8wGlL8mJ9G\nF37CM3gFQ3Ik7odwOpv3G7xM1LTX1mdVGjYkPQ9INVkAz3BaL0oxz7rw0fslHoFv\nKLGC2Tten/GyTMb1yc+7bB+z8ZEaVHDHbP/Fmz/4W/BPOg0djRoF+Fu1no1ioz1w\npkuUKHtf9wKBgFHNzHo8I/vZ6ZaEG5Zcnm0mw9LVgXQ5rQGH8PV5JZiqqiEsn0St\n8ZpQbgeVWIWQiHT4Q89XneHcMa5TSM8XilpM5fhRapi+q1uspJJz/GjSZKFXntJj\nvIMTtPQLdqM4cv36mhT+VwAXWDUS2a46FrKFJrAoui9ggOVWUd7MmSobAoGAbbns\nGc+86LutMWhZ+kuHEJHPfdhEve7yfBQfTrRIB76xgCHqjbYAmiizljX4qLAJrSMR\njNALSGX/dS7iYxOF9gbmqC9WG5PBDKCFl/Zdfz7yXrFrSbe/xTNIFkulC7pXn9U4\n9pcon6EtyL3a1Nsd6QSIqIeIr0IDb8B6EGRv/OkCgYAzHolhsv7uRcS2xTFxUJKW\nQx+E8akybqlzpJQAIaQMMKcBxD39BYsQYoBystljNI+Gfbwe4o1VmE30PMCzt+qX\nPP97RPdxsyqkkthk6CK4slLckTet9wTuXLz+qik49YoQu7HtI97zDPhlBpTa3Wat\ndvi+O9Dhtok6M+qdouDAdQ==\n-----END PRIVATE KEY-----\n","client_email": "driveuploader@isms-file-store.iam.gserviceaccount.com","client_id": "116465924169126543606","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/driveuploader%40isms-file-store.iam.gserviceaccount.com","universe_domain": "googleapis.com"}'


COPY --from=build /home/gradle/project/src/main/resources/application.properties .
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]