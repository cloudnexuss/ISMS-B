# Stage 1: Build the application
FROM gradle:8.5.0-jdk21 AS build
WORKDIR /home/gradle/project
COPY --chown=gradle:gradle . .
RUN gradle build -x test

# Stage 2: Create the runtime image
FROM eclipse-temurin:21-jdk-jammy
WORKDIR /app
COPY --from=build /home/gradle/project/build/libs/*.jar app.jar
# Set the Firebase credentials as an environment variable (INSECURE)
ENV FIREBASE_SERVICE_ACCOUNT='{"type": "service_account","project_id": "isms-f64f7","private_key_id": "f9515b2adcb685caca736bbe12120503e73a9d0a","private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCzlSOLks5NjEmQ\nhScfFHYHpv8mF16+dXHec2gjRXnNAaFnt1s8q4PNix7fHn2EtNkVcGsujhHpCUVV\nmoPYpWdXp/NkGGL7C09e9mNNSWpHhGvpJQcogtQwO6PCxNbt+LV7qb3CAFZVFylL\nO6UnlgHFn+hJ0ViAoR1O6/gPXl+jd/lHvjmgYRFL8WzHNnYjVkG8tJGV7uEVGzTe\nQ3dlQi6MtBXhw/gG9wyr2pDaMeeKwaIhqh6Hw0YZHWXXlqeRJZAJBAbdHLPRhIaK\npg4R7pIaDakLfY/dkBpVUhhgGNtkTPib6+DnQXo4bB/IPCXshxSsnkLC1anuzXOx\nTOScyLwzAgMBAAECggEAF8W42FudMrfM7zQpKxyWyUmKghza3mSGp9doJC8owgIi\nvyuPCNd9kaKGeiu7musjx4pDrfyBk3M2OfBD3tR6eyiQ+CGgTLJBFgWQvKTozEHT\n1R+hNHQpKZ9jfL944jSntZCRPZK02vu/bCWfpb9eSa5y3f639AMf8ZgcFNC94VIh\neY1IwpELrKlJhKtY7dxEq8NBmv6bwrNggsBuLgdEZRfdceBzyHsqhBtaEgSyBHn4\nwjETKRKLZI0QSKe/iOduFkn+MN9hHKR3+jjw7ZjQWJv1pXzzFyue93gqqPFA+R6R\nH4JVh5bMVR+tnyBqbBYjIRASYcM7muKUJc/bxdNnRQKBgQD6gUwbr+E/faHBt7SH\nlbxTJt2F0s8Hvr0NUPlw2QvDe0SIaPKTsiSEZcCAWBKCfgI6mMgHVbu15SP6QIpA\nuMXyf8sCKvLvNLbt1pUqnpLMR0euVc9SwGg635qK2IGRiSu3AjJClIp2QivNjFxQ\nctQWb57R6a5JYwOiiEcs2VKCtQKBgQC3hZQlSpvf+oQR3nu7cD/XidFH7CJ/SI3G\nWPUw5Ll7Y+77xGRWxjHyoPZHxD463Mv/YUmvJP7b/hQZyUzfOF2FQkg+yYRYLu0f\nZ01kF1+rZp247BsjGUTntGsbiRkzoAnGcetl4DZzIxbEJFrlrOjECrWoH1JFf4Wu\nY0lVc24MRwKBgEj/yMgAtukjmTG0cP1Z2yl4F/HZfs9I/BqXUDlcZpsunsgJnTcB\nILccV76O68XvJoMg5pmMmEjnX1ab3C4EKlsCdoxJK8YdXHluoMVstGanFvJsux/o\nRfdyFb0EXq2khYKtNyxD0R2pJs6daoFfFQL8wBF3wXxNSE/i2qrtIahJAoGAUpjU\nLFSAAzaE6mXv2lSS5zcn8e7dN9w3suWmtPK8aER58uZZIpThNgorzfEM8QEe7zmi\nKCnGaszXzyNCbdS4gplqWpfn8KhuIIwl0L6UWFg+9FOPgySEVqRk8Ger6AhHXgE3\nqQpYd0l7nZufLW+88z6+s4QlSxIx4GLfRo5FIVECgYBY5ol4bI2CiwhRiGCz80PI\n5d8y/ApnduH3fUqbRLSfeENp1je20LGZLn607qs9LcadPbAFlWn3Uex3aMw2diJF\nNm5fHw02LIaXrHrAhDZWheXlZ53qnQaXCM3fg1M2ZfxOVWymAbCbO0Y3oFDvf35X\n6S+JFI3FDG0sI5eY2q1P1w==\n-----END PRIVATE KEY-----\n","client_email": "firebase-adminsdk-fbsvc@isms-f64f7.iam.gserviceaccount.com","client_id": "104421130341628731170","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40isms-f64f7.iam.gserviceaccount.com","universe_domain": "googleapis.com"}'
ENV DRIVE_SERVICE_ACCOUNT='{"type": "service_account","project_id": "isms-file-store","private_key_id": "6a965ee8bd7c2ed83962fa5e48ccaa80bd322081","private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQChYQcfg4dqb4+0\nGEdzivLaIB+FiUpzyeHYAsstIyak/SZ0BwXx5LRD8BfgTIIozsmRARKK4LatrKII\nTqxktZXl0lge8XlsrkHDI2BWZGAqrcXFrVb78i9oaXP2OdA/lDxkm3kKGkVdxJrX\nkDeDMV5tLTYZzKWo9lfh5g4yHePjji5RnINT6yfiWdSmtO9ano98QyyVM0mrySQG\nzzC14HTTe1YKffU6Fbj+vTLNLV04/viHZIngWXJ17LLHWW1rnizvzG34qwoHKsV0\nJJUOMHLCyc3gKWYJ4wFuVFZeUjkpbLdcQcoiKhilz7Wz3fUwSWm2mEF0bF2p5EGz\ni6vEl8adAgMBAAECggEAB8b7tBkZCmTpMaGGtmeYrJc/unL5xseQvft+FZhlrfqr\nqViggLfbUcR2yIIanVZzgF/jQa4l7HJiNkqt8QYo4zQjHkELVdS2dqEN04JvrNIT\nGSO+PWyLVfM/E268PbqQu1VPnNA6gS2O1ZsUEc6Frnbih8iR2akfMyCf+1C72thV\nURgobqkMjrPYf7+r4bvqqiD/E8/giuQ1MPt+pbHCaKsaFtzbH/GraeWWc0/49O7g\nibXi7iXkc0+/JUUnE7yKa7bjLcOKC6P7xqvYuZhWOuygNPtZffPBHSmTKlAOgYlM\nA2IWerVonxJ9y5JYTLT4HXXRbvhVWr/2Gg0RFyTOQQKBgQDPiEXD7tGNezP7Lkor\nbUNvFz+HHRF89sQvvCmOUNXArc5Zq97Bbny6NJ/dd9IMHseyjVdkA5Rk5wNJCPCi\nNQgiZkCGXvHrdaj+zQlL3XaE9Tj9GVI4xNZlk+JjFRW9LdW/s381Sgk9fmcL2kpu\n7ZY6kMEsxtBdVl3dNXSeqR7RCwKBgQDHEWO44HDhXHseLASq6d7rgu8wGlL8mJ9G\nF37CM3gFQ3Ik7odwOpv3G7xM1LTX1mdVGjYkPQ9INVkAz3BaL0oxz7rw0fslHoFv\nKLGC2Tten/GyTMb1yc+7bB+z8ZEaVHDHbP/Fmz/4W/BPOg0djRoF+Fu1no1ioz1w\npkuUKHtf9wKBgFHNzHo8I/vZ6ZaEG5Zcnm0mw9LVgXQ5rQGH8PV5JZiqqiEsn0St\n8ZpQbgeVWIWQiHT4Q89XneHcMa5TSM8XilpM5fhRapi+q1uspJJz/GjSZKFXntJj\nvIMTtPQLdqM4cv36mhT+VwAXWDUS2a46FrKFJrAoui9ggOVWUd7MmSobAoGAbbns\nGc+86LutMWhZ+kuHEJHPfdhEve7yfBQfTrRIB76xgCHqjbYAmiizljX4qLAJrSMR\njNALSGX/dS7iYxOF9gbmqC9WG5PBDKCFl/Zdfz7yXrFrSbe/xTNIFkulC7pXn9U4\n9pcon6EtyL3a1Nsd6QSIqIeIr0IDb8B6EGRv/OkCgYAzHolhsv7uRcS2xTFxUJKW\nQx+E8akybqlzpJQAIaQMMKcBxD39BYsQYoBystljNI+Gfbwe4o1VmE30PMCzt+qX\nPP97RPdxsyqkkthk6CK4slLckTet9wTuXLz+qik49YoQu7HtI97zDPhlBpTa3Wat\ndvi+O9Dhtok6M+qdouDAdQ==\n-----END PRIVATE KEY-----\n","client_email": "driveuploader@isms-file-store.iam.gserviceaccount.com","client_id": "116465924169126543606","auth_uri": "https://accounts.google.com/o/oauth2/auth","token_uri": "https://oauth2.googleapis.com/token","auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/driveuploader%40isms-file-store.iam.gserviceaccount.com","universe_domain": "googleapis.com"}'


COPY --from=build /home/gradle/project/src/main/resources/application.properties .
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]